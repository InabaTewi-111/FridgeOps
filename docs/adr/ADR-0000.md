# ADR-000: アーキテクチャ方針（FridgeOps）

- Status: Accepted
- Date: 2026-01-22
- Updated: 2026-02-06

## Context
ポートフォリオ用途。アプリ機能は最小でOK。代わりに「クラウド構成として説明できるもの」を IaC と証跡で残す。

見せたい軸
- secure-by-default static hosting: CloudFront + OAC + private S3 bucket
- CI without long-lived keys: GitHub Actions + OIDC
- minimum E2E: API Gateway + Lambda + DynamoDB
- Observability + cost control: CloudWatch, alarms, basic guardrails

## Decision
- Entry は CloudFront に寄せる
  - default: S3（OAC 経由、private）
  - `/api/*`: API 側に route（同一ドメインで呼べる）
- v1 / v2 の 2 段階に分け、まず v1 の仕上げを最優先にする
  - v1: 検収できる E2E（apply → verify → destroy）
  - v2: v1 の上に実用性を積む（AI / cache / risk & cost control）
- v1 の Lambda は VPC に入れない（必要になったら理由と egress 方針を別途明文化）
- v1 では認証は入れない（単一ユーザー demo）
- external API（OpenAI 等）は v2。secret は repo/CI/frontend に置かず runtime 取得（Secrets Manager or SSM）

## Options (high level)
- Entry を CloudFront に寄せない（S3 direct / API direct）: 不採用
- Lambda を VPC に入れる: v1 では不採用
- v1 から OpenAI を入れる: 不採用（v2 に分離）

## Rationale (notes)
- CloudFront に入口を集約すると static と API の境界が明確になる
- v1 は「動く・検収できる・片付く」を優先し、scope creep を抑える
- v2 で guardrails（WAF/throttling/budgets/alarms/concurrency/feature flag）を体系化できる

## Consequences
- docs は v1/v2 を混線させない（README / ADR / architecture を正として揃える）
- API 種別と v1 contract は ADR-0002 で固定する
- v2 の AI / cache / guardrails は v2 着手時にまとめて追記する（v1 側に混ぜない）

## References
- v1 Architecture: assets/architecturev1.md
- API decision/contract: docs/adr/ADR-0002.md
- Work log: docs/progress.md

